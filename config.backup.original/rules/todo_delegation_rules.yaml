# TODO Delegation Rules
# Rules and constraints for automatic Task() delegation through TODO-EXECUTION Engine

metadata:
  name: "todo_delegation_rules"
  version: "0.2.0"
  description: "Rules for TODO-EXECUTION Engine automatic Task() delegation"
  author: "Master Agent System v0.2.0"

# Delegation Activation Rules
delegation_triggers:
  # Complexity-based Triggers
  complexity_thresholds:
    minimum_complexity_for_delegation: 2
    force_delegation_complexity: 4
    multi_agent_coordination_complexity: 3

  # Domain-based Triggers
  domain_triggers:
    multi_domain_tasks: ["development + testing", "architecture + implementation", "research + development"]
    specialist_required_domains: ["security", "performance", "infrastructure", "research"]
    cross_domain_coordination: ["frontend + backend", "development + deployment", "analysis + implementation"]

  # Task Type Triggers
  task_type_triggers:
    research_tasks: ["research", "investigate", "analyze", "explore"]
    development_tasks: ["implement", "develop", "code", "build", "create"]
    testing_tasks: ["test", "validate", "verify", "qa", "quality"]
    design_tasks: ["design", "architecture", "plan", "structure"]
    infrastructure_tasks: ["deploy", "configure", "setup", "environment"]

# Agent Selection Rules
agent_selection_rules:
  # Primary Agent Selection Criteria
  primary_selection_criteria:
    competency_match_minimum: 0.7
    tfidf_similarity_minimum: 0.6
    availability_required: true
    performance_history_weight: 0.25

  # Fallback Agent Selection
  fallback_selection:
    competency_match_minimum: 0.5
    tfidf_similarity_minimum: 0.4
    availability_fallback: true
    master_agent_as_last_resort: true

  # Multi-agent Coordination Rules
  coordination_rules:
    max_parallel_agents: 5
    dependency_resolution_required: true
    cross_agent_communication: true
    result_synthesis_required: true

# Task Delegation Constraints
delegation_constraints:
  # Resource Constraints
  resource_limits:
    max_concurrent_delegations: 10
    max_total_execution_time: 3600  # seconds
    max_retry_attempts: 3
    delegation_timeout: 300  # seconds per task

  # Quality Constraints
  quality_requirements:
    minimum_result_quality_score: 0.7
    completeness_validation_required: true
    consistency_check_required: true
    user_satisfaction_prediction_minimum: 0.8

  # Security Constraints
  security_constraints:
    sensitive_task_handling: "manual_review_required"
    data_privacy_validation: true
    agent_capability_validation: true
    audit_trail_required: true

# TODO Planning Rules
todo_planning_rules:
  # Task Decomposition Rules
  decomposition_rules:
    maximum_tasks_per_plan: 20
    minimum_task_granularity: "15_minutes"
    maximum_task_complexity: 5
    dependency_depth_limit: 5

  # Priority Assignment Rules
  priority_rules:
    critical_priority_indicators: ["security", "production", "urgent", "blocking"]
    high_priority_indicators: ["performance", "user-facing", "integration"]
    medium_priority_indicators: ["enhancement", "optimization", "refactoring"]
    low_priority_indicators: ["documentation", "cleanup", "optional"]

  # Dependency Management Rules
  dependency_rules:
    circular_dependency_resolution: "error_with_suggestions"
    maximum_dependencies_per_task: 10
    cross_phase_dependencies: "allowed_with_validation"
    soft_dependencies: "allowed"

# Execution Flow Rules
execution_flow_rules:
  # Pre-execution Validation
  pre_execution_validation:
    agent_availability_check: true
    resource_sufficiency_check: true
    task_requirements_clarity_check: true
    dependency_satisfaction_check: true

  # Execution Monitoring
  execution_monitoring:
    progress_tracking_required: true
    performance_monitoring_enabled: true
    error_detection_enabled: true
    timeout_monitoring_enabled: true

  # Post-execution Processing
  post_execution_processing:
    result_quality_validation: true
    todo_status_update_required: true
    dependent_task_triggering: true
    performance_metrics_collection: true

# Error Handling Rules
error_handling_rules:
  # Classification Rules
  error_classification:
    agent_related_errors: ["agent_unavailable", "capability_mismatch", "timeout"]
    task_related_errors: ["ambiguous_requirements", "insufficient_resources", "dependency_failure"]
    system_related_errors: ["task_system_unavailable", "network_issues", "resource_exhaustion"]

  # Recovery Strategies
  recovery_strategies:
    agent_substitution:
      max_alternative_agents: 3
      performance_threshold_minimum: 0.6
      retry_with_different_agent: true

    task_decomposition:
      complexity_reduction_factor: 0.5
      maximum_decomposition_depth: 3
      subtask_priority_boost: true

    escalation_handling:
      max_retry_attempts: 3
      human_intervention_trigger: "critical_or_repeated_failures"
      blocking_behavior: "pause_execution_and_notify"

# Performance Optimization Rules
performance_optimization_rules:
  # Caching Rules
  caching_rules:
    agent_selection_cache_ttl: 300  # seconds
    task_analysis_cache_ttl: 600  # seconds
    delegation_result_cache_ttl: 1200  # seconds

  # Parallel Execution Rules
  parallel_execution_rules:
    parallel_threshold_complexity: 3
    maximum_parallel_tasks: 5
    resource_allocation_optimization: true
    load_balancing_enabled: true

  # Learning and Adaptation Rules
  learning_rules:
    performance_feedback_integration: true
    agent_selection_weight_adjustment: true
    delegation_pattern_learning: true
    success_rate_threshold_adjustment: true

# Integration Rules
system_integration_rules:
  # TF-IDF Integration Rules
  tfidf_integration:
    category_weight_in_selection: 0.6
    similarity_threshold_minimum: 0.5
    cross_category_coordination: true
    dynamic_threshold_adjustment: true

  # Agent Selection Integration Rules
  agent_selection_integration:
    unified_selection_weight: 0.7
    competency_vector_weight: 0.25
    historical_performance_weight: 0.05
    domain_specialization_boost: 0.1

  # Monitoring Integration Rules
  monitoring_integration:
    real_time_progress_tracking: true
    performance_metrics_collection: true
    error_pattern_analysis: true
    system_health_monitoring: true

# Rule Validation and Compliance
rule_validation:
  # Validation Rules
  validation_rules:
    rule_consistency_check: true
    conflict_resolution_required: true
    performance_impact_assessment: true
    security_impact_assessment: true

  # Compliance Requirements
  compliance_requirements:
    audit_trail_maintenance: true
    rule_version_tracking: true
    change_management_process: true
    quality_assurance_validation: true

# Rule Adaptation and Evolution
rule_adaptation:
  # Dynamic Rule Adjustment
  dynamic_adjustment:
    performance_based_adjustment: true
    user_feedback_integration: true
    system_behavior_learning: true
    environmental_adaptation: true

  # Rule Evolution Process
  evolution_process:
    performance_monitoring: "continuous"
    rule_effectiveness_analysis: "weekly"
    adaptation_trigger_conditions: ["performance_degradation", "user_feedback", "system_changes"]
    rollback_capability: true