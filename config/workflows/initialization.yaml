name: "System Initialization Workflow"
description: "5 sequential stages to prepare the master agent system for operation"
version: "1.0"
author: "Master Agent System"

metadata:
  created: "2024-01-01"
  updated: "2024-01-01"
  execution_mode: "sequential"
  timeout_minutes: 10
  retry_attempts: 3

stages:
  - id: "stage_1"
    name: "System Availability Check"
    description: "Verify system components availability and basic functionality"
    action: "check_system_availability"
    timeout_seconds: 30
    required_resources: ["memory", "storage", "file_system"]
    outputs: ["system_check_passed", "available_resources"]
    dependencies: []
    validation:
      success_criteria: ["system_check_passed == true", "available_resources.memory > 0"]
      fallback_action: "minimal_mode_initialization"

  - id: "stage_2"
    name: "Configuration Loading and Validation"
    description: "Load and validate all configuration files"
    action: "load_and_validate_configurations"
    timeout_seconds: 45
    required_resources: ["cpu", "memory"]
    inputs: ["system_check_passed"]
    outputs: ["config_loaded", "config_validated", "agent_capabilities"]
    dependencies: ["stage_1"]
    validation:
      success_criteria: ["config_loaded == true", "config_validated == true"]
      fallback_action: "use_default_configurations"
    required_files:
      - "config/agents/master_agents.yaml"
      - "config/rules/selection_rules.yaml"

  - id: "stage_3"
    name: "Initialize Agent Capabilities"
    description: "Set up dynamic categorization and agent capabilities"
    action: "initialize_categories_system"
    timeout_seconds: 60
    required_resources: ["cpu", "memory"]
    inputs: ["config_validated", "agent_capabilities"]
    outputs: ["categories_data", "classification_ready", "agents_initialized"]
    dependencies: ["stage_2"]
    validation:
      success_criteria: ["agents_initialized == true", "categories_data.task_types not empty"]
      fallback_action: "initialize_minimal_categories"

  - id: "stage_4"
    name: "Build Compatibility Matrix"
    description: "Create agent-task compatibility matrix for intelligent selection"
    action: "initialize_task_matrix_system"
    timeout_seconds: 90
    required_resources: ["cpu", "memory"]
    inputs: ["categories_data", "agents_initialized"]
    outputs: ["matrix_data", "compatibility_ready"]
    dependencies: ["stage_3"]
    validation:
      success_criteria: ["matrix_data.task_types not empty", "compatibility_ready == true"]
      fallback_action: "create_default_matrix"

  - id: "stage_5"
    name: "Configure Selection Filters and Rules"
    description: "Set up intelligent filters and selection rules"
    action: "initialize_filters_system"
    timeout_seconds: 60
    required_resources: ["cpu", "memory"]
    inputs: ["matrix_data"]
    outputs: ["filters_data", "selection_ready"]
    dependencies: ["stage_4"]
    validation:
      success_criteria: ["selection_ready == true", "filters_data.criteria defined"]
      fallback_action: "use_basic_filters"

  - id: "stage_6"
    name: "Activate Clarification System"
    description: "Initialize clarification system for ambiguous requests"
    action: "initialize_clarification_system"
    timeout_seconds: 45
    required_resources: ["cpu", "memory"]
    inputs: ["filters_data"]
    outputs: ["clarification_system", "system_fully_ready"]
    dependencies: ["stage_5"]
    validation:
      success_criteria: ["clarification_system.enabled == true", "system_fully_ready == true"]
      fallback_action: "activate_basic_clarification"

  
error_handling:
  retry_policy:
    max_retries: 3
    retry_delay_seconds: 5
    exponential_backoff: true
    max_total_time: 600  # 10 minutes total

  recovery_mechanisms:
    fallback_mode: true
    minimal_functionality: true
    partial_initialization: true

  failure_actions:
    - action: "log_error_detailed"
      parameters: ["stage_name", "error_message", "timestamp", "context"]
    - action: "cleanup_partial_state"
      parameters: ["completed_stages", "failed_stage"]
    - action: "create_recovery_checkpoint"
      parameters: ["successful_outputs"]
    - action: "attempt_graceful_degradation"
      parameters: ["available_components"]

  critical_failures:
    - condition: "stage_1 fails"
      action: "emergency_minimal_mode"
      description: "Initialize with basic functionality only"
    - condition: "config_validation fails"
      action: "use_hardcoded_defaults"
      description: "Fallback to built-in default configurations"
    - condition: "all_agents_unavailable"
      action: "enable_general_purpose_only"
      description: "Use only general-purpose agent with basic capabilities"

success_actions:
  - action: "log_success"
    parameters: ["workflow_name", "total_duration"]
  - action: "update_system_status"
    parameters: ["status=ready", "version=current"]
  - action: "cache_initialization_state"
    parameters: ["all_outputs"]

monitoring:
  metrics:
    - name: "stage_duration"
      type: "timing"
      description: "Time taken for each stage"
    - name: "resource_usage"
      type: "resource"
      description: "CPU and memory usage during initialization"
    - name: "error_rate"
      type: "counter"
      description: "Number of errors during initialization"

  alerts:
    - condition: "stage_duration > timeout_seconds * 0.8"
      action: "performance_warning"
    - condition: "error_rate > 0"
      action: "error_notification"