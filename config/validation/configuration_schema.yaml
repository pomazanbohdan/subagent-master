name: "Configuration Validation Framework"
description: "Comprehensive validation framework for all configuration types"
version: "2.5.0"
configuration_type: "validation_framework"

# Validation Schema Definitions
validation_schemas:
  # Master Agents Configuration Schema
  master_agents_schema:
    description: "Schema for validating master_agents.yaml"
    version: "2.5.0"

    root_object: "agents"

    required_structure:
      name: "string [1,100]"
      description: "string [10,500]"
      capabilities: "array [1,20] of strings"
      competencies: "object with competency scores [0.0,1.0]"
      performance: "object with performance metrics"
      capacity: "object with capacity settings"
      specialization: "object with specialization info"
      business: "object with business info"
      technical: "object with technical details"
      error_handling: "object with error handling config"

    field_validations:
      # Agent identification
      name:
        type: "string"
        required: true
        min_length: 1
        max_length: 100
        pattern: "^[a-zA-Z0-9_-]+$"
        description: "Unique identifier for the agent"

      description:
        type: "string"
        required: true
        min_length: 10
        max_length: 500
        description: "Human-readable description of agent capabilities"

      # Capabilities and competencies
      capabilities:
        type: "array"
        required: true
        min_items: 1
        max_items: 20
        item_type: "string"
        unique_items: true
        description: "List of agent capabilities"

      competencies:
        type: "object"
        required: true
        min_properties: 3
        description: "Competency scores for different skills"
        validation_rules:
          - "All values must be numeric"
          - "All values must be between 0.0 and 1.0"
          - "At least 3 competencies required"

      # Performance metrics
      performance:
        type: "object"
        required: true
        required_fields:
          - success_rate
          - avg_response_time
          - reliability
          - total_tasks_completed
        field_validations:
          success_rate:
            type: "float"
            min_value: 0.0
            max_value: 1.0
            description: "Historical success rate (0.0-1.0)"

          avg_response_time:
            type: "float"
            min_value: 0.1
            max_value: 300.0
            description: "Average response time in seconds"

          reliability:
            type: "float"
            min_value: 0.0
            max_value: 1.0
            description: "Reliability score (0.0-1.0)"

          total_tasks_completed:
            type: "integer"
            min_value: 0
            description: "Total number of tasks completed"

        recent_performance:
          type: "object"
          required_fields:
            - tasks_completed
            - avg_success_rate
            - avg_response_time
            - user_satisfaction
          validation_rules:
            - "Recent performance must be consistent with historical data"

      # Capacity settings
      capacity:
        type: "object"
        required: true
        required_fields:
          - max_concurrent_tasks
          - current_load
          - load_factor
        field_validations:
          max_concurrent_tasks:
            type: "integer"
            min_value: 1
            max_value: 50
            description: "Maximum number of concurrent tasks"

          current_load:
            type: "integer"
            min_value: 0
            description: "Current number of active tasks"
            validation_rule: "current_load <= max_concurrent_tasks"

          load_factor:
            type: "float"
            min_value: 0.1
            max_value: 5.0
            description: "Load multiplier for task allocation"

      # Specialization
      specialization:
        type: "object"
        required: true
        required_fields:
          - primary_domain
          - experience_level
        field_validations:
          primary_domain:
            type: "string"
            allowed_values:
              - "coordination"
              - "backend_development"
              - "frontend_development"
              - "security_engineering"
              - "performance_engineering"
            description: "Primary area of expertise"

          experience_level:
            type: "string"
            allowed_values:
              - "beginner"
              - "intermediate"
              - "advanced"
              - "expert"
            description: "Experience level of the agent"

    cross_field_validations:
      - name: "performance_consistency"
        description: "Recent performance should be consistent with historical data"
        validation: |
          def validate_performance_consistency(historical, recent):
              if abs(historical['success_rate'] - recent['avg_success_rate']) > 0.2:
                  raise ValidationError("Recent success rate deviates too much from historical")
              if historical['avg_response_time'] * 0.5 > recent['avg_response_time'] > historical['avg_response_time'] * 2.0:
                  raise ValidationError("Recent response time unrealistic compared to historical")

      - name: "capacity_logical_consistency"
        description: "Capacity settings should be logically consistent"
        validation: |
          def validate_capacity_logic(capacity):
              if capacity['current_load'] > capacity['max_concurrent_tasks']:
                  raise ValidationError("Current load cannot exceed maximum capacity")
              if capacity['max_concurrent_tasks'] < 1:
                  raise ValidationError("Maximum concurrent tasks must be at least 1")

  # Configuration Rules Schema
  configuration_rules_schema:
    description: "Schema for validating rules configuration files"
    version: "2.5.0"

    required_structure:
      selection_criteria: "object with scoring weights"
      performance_thresholds: "object with threshold values"
      learning: "object with learning configuration"

    field_validations:
      selection_criteria:
        type: "object"
        required: true
        required_fields:
          - competency_weight
          - performance_weight
          - availability_weight
          - specialization_weight
          - cost_weight
        validation_rules:
          - "All weights must be numeric"
          - "Sum of weights should equal 1.0"
          - "All weights must be between 0.0 and 1.0"

      performance_thresholds:
        type: "object"
        required: true
        required_fields:
          - min_success_rate
          - max_response_time
          - min_reliability
          - max_load_factor
        validation_rules:
          - "All thresholds must be realistic"
          - "Thresholds should not conflict with agent capabilities"

  # Workflows Configuration Schema
  workflows_schema:
    description: "Schema for validating workflow configuration files"
    version: "2.5.0"

    required_structure:
      workflow_name: "string"
      workflow_type: "string"
      steps: "array of workflow steps"
      dependencies: "object with step dependencies"

    field_validations:
      workflow_name:
        type: "string"
        required: true
        pattern: "^[a-zA-Z0-9_-]+$"
        description: "Unique workflow identifier"

      workflow_type:
        type: "string"
        required: true
        allowed_values:
          - "initialization"
          - "parallel_initialization"
          - "task_execution"
          - "error_recovery"
        description: "Type of workflow"

      steps:
        type: "array"
        required: true
        min_items: 1
        item_validation:
          type: "object"
          required_fields:
            - step_id
            - step_name
            - step_type
            - execution_order
          validation_rules:
            - "Step IDs must be unique"
            - "Execution orders must be sequential"

# Custom Validation Functions
custom_validators:
  competency_score_validator:
    description: "Validate competency scores are within valid ranges and realistic"
    implementation: |
      def validate_competency_scores(competencies, agent_context):
          """
          Validate competency scores are realistic and consistent
          """
          if not competencies or len(competencies) < 3:
              raise ValidationError("Agent must have at least 3 competencies")

          total_score = 0
          for skill, score in competencies.items():
              if not isinstance(score, (int, float)):
                  raise ValidationError(f"Competency score for {skill} must be numeric")

              if not 0.0 <= score <= 1.0:
                  raise ValidationError(f"Competency score for {skill} must be between 0.0 and 1.0")

              total_score += score

          # Check if total competency is realistic
          avg_competency = total_score / len(competencies)
          if avg_competency > 0.95:
              raise ValidationError("Average competency score is unrealistically high")

          # Validate specific competency requirements based on agent type
          if agent_context.get('specialization', {}).get('primary_domain'):
              required_skills = get_required_skills_for_domain(
                  agent_context['specialization']['primary_domain']
              )
              for skill in required_skills:
                  if skill not in competencies:
                      raise ValidationError(f"Missing required skill {skill} for domain")

          return True

  performance_validator:
    description: "Validate performance metrics are realistic and consistent"
    implementation: |
      def validate_performance_metrics(performance, agent_context):
          """
          Validate performance metrics are realistic and consistent
          """
          # Check required metrics
          required_metrics = ['success_rate', 'avg_response_time', 'reliability']
          for metric in required_metrics:
              if metric not in performance:
                  raise ValidationError(f"Missing required performance metric: {metric}")

          # Validate ranges
          if not 0.0 <= performance['success_rate'] <= 1.0:
              raise ValidationError("Success rate must be between 0.0 and 1.0")

          if performance['avg_response_time'] <= 0 or performance['avg_response_time'] > 300:
              raise ValidationError("Average response time must be between 0 and 300 seconds")

          if not 0.0 <= performance['reliability'] <= 1.0:
              raise ValidationError("Reliability must be between 0.0 and 1.0")

          # Check consistency between metrics
          if performance['success_rate'] < 0.5 and performance['reliability'] > 0.9:
              raise ValidationError("Low success rate but high reliability is inconsistent")

          # Validate recent performance consistency
          if 'recent_performance' in performance:
              recent = performance['recent_performance']
              if abs(performance['success_rate'] - recent['avg_success_rate']) > 0.3:
                  raise ValidationError("Recent success rate deviates too much from historical")

          return True

  capacity_validator:
    description: "Validate capacity settings are logical and feasible"
    implementation: |
      def validate_capacity_settings(capacity, agent_context):
          """
          Validate capacity settings are logical and feasible
          """
          # Check required fields
          required_fields = ['max_concurrent_tasks', 'current_load', 'load_factor']
          for field in required_fields:
              if field not in capacity:
                  raise ValidationError(f"Missing required capacity field: {field}")

          # Validate ranges
          if capacity['max_concurrent_tasks'] <= 0 or capacity['max_concurrent_tasks'] > 50:
              raise ValidationError("Max concurrent tasks must be between 1 and 50")

          if capacity['current_load'] < 0:
              raise ValidationError("Current load cannot be negative")

          if capacity['current_load'] > capacity['max_concurrent_tasks']:
              raise ValidationError("Current load cannot exceed max concurrent tasks")

          if not 0.1 <= capacity['load_factor'] <= 5.0:
              raise ValidationError("Load factor must be between 0.1 and 5.0")

          # Validate load factor consistency
          current_load_ratio = capacity['current_load'] / capacity['max_concurrent_tasks']
          if current_load_ratio > 0.8 and capacity['load_factor'] < 1.0:
              raise ValidationError("High current load but low load factor is inconsistent")

          return True

# Validation Pipeline
validation_pipeline:
  pre_validation:
    - name: "file_exists_check"
      description: "Check if configuration file exists and is readable"

    - name: "file_format_check"
      description: "Verify file is valid YAML format"

  schema_validation:
    - name: "structure_validation"
      description: "Validate against predefined schema"

    - name: "required_fields_check"
      description: "Ensure all required fields are present"

  custom_validation:
    - name: "business_logic_validation"
      description: "Apply business rules and constraints"

    - name: "consistency_validation"
      description: "Check cross-field consistency"

  post_validation:
    - name: "performance_impact_assessment"
      description: "Assess impact of configuration on system performance"

    - name: "security_validation"
      description: "Check for security implications"

# Error Reporting
error_reporting:
  validation_error_format:
    error_code: "string"
    error_type: "string"
    field_path: "string"
    error_message: "string"
    suggested_fix: "string"
    severity: "low|medium|high|critical"

  common_errors:
    - error_code: "REQ_FIELD_MISSING"
      error_type: "schema_validation"
      message_template: "Required field '{field_name}' is missing in {config_type}"
      suggested_fix: "Add the required field with appropriate value"

    - error_code: "INVALID_VALUE_RANGE"
      error_type: "field_validation"
      message_template: "Value '{value}' for field '{field_name}' is outside valid range [{min}, {max}]"
      suggested_fix: "Provide a value within the specified range"

    - error_code: "INCONSISTENT_VALUES"
      error_type: "consistency_validation"
      message_template: "Values for {field1} and {field2} are inconsistent"
      suggested_fix: "Review and align the conflicting values"

# Validation Configuration
validation_config:
  strict_mode: false  # Allow some flexibility during development
  fail_fast: false     # Collect all errors before failing
  detailed_reporting: true
  auto_fix_minor_issues: true
  cache_validation_results: true
  validation_timeout: 30  # seconds