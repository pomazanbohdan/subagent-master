# Task Delegation System (Optimized v1.0.0)
# Intelligent task delegation with agent selection optimization and adaptive fallback mechanisms

component:
  name: "delegation"
  version: "1.0.0"
  description: "Task delegation system with intelligent agent selection, coordination integration, and adaptive fallback mechanisms"
  category: "execution"
  priority: 2  # Critical for task execution
  status: "stable"

triggers:
  primary:
    keywords: ["delegate", "assign", "execute", "perform", "complete", "task_execution"]
    patterns: [".*delegate.*task.*", ".*assign.*agent.*", ".*execute.*task.*", ".*complete.*work.*"]
    score: 1.0
  secondary:
    keywords: ["coordinate", "orchestrate", "manage", "supervise", "oversee"]
    patterns: [".*coordinate.*execution.*", ".*orchestrate.*tasks.*", ".*manage.*workflow.*"]
    score: 0.7
  contextual:
    conditions:
      - "task_ready_for_execution"
      - "agent_selection_completed"
      - "complex_task_requires_coordination"
      - "batch_operations_detected"
    score: 0.5

implementation:
  operations:
    - name: "delegation_criteria_evaluation"
      method: "multi_factor_activation_analysis"
      priority: 1
      config:
        activation_triggers:
          complexity_threshold: 2.0
          priority_threshold: 0.6
          confidence_threshold: 0.6
          multi_agent_coordination_threshold: 3.0
          batch_operation_threshold: 3
          identical_pattern_operations: true

        evaluation_factors:
          task_complexity:
            weight: 0.3
            scoring_method: "task_analysis_complexity_score"
          agent_availability:
            weight: 0.25
            scoring_method: "agent_registry_availability_check"
          performance_requirements:
            weight: 0.2
            scoring_method: "historical_performance_analysis"
          coordination_needs:
            weight: 0.15
            scoring_method: "task_dependency_analysis"
          resource_constraints:
            weight: 0.1
            scoring_method: "system_resource_assessment"
      output:
        delegation_required: "boolean"
        delegation_strategy: "string"
        confidence_score: "float"
        coordination_needs: "object"

    - name: "batch_integration_preparation"
      method: "parallel_operation_planning"
      priority: 2
      config:
        batch_integration:
          enabled: true
          task_analysis_integration:
            use_batch_detection_results: true
            validate_batch_independence: true
            prepare_batch_execution_plan: true

        batch_preparation_workflow:
          receive_batch_info:
            - "Get batch detection results from task_analysis"
            - "Validate batch feasibility"
            - "Check resource availability"
          independence_validation:
            - "Validate no dependencies between operations"
            - "Check resource contention"
            - "Validate safety constraints"
          resource_allocation:
            - "Assign optimal agent per operation"
            - "Balance load across available agents"
            - "Set concurrent execution limits"
          execution_planning:
            - "Create detailed execution timeline"
            - "Set up monitoring checkpoints"
            - "Prepare fallback mechanisms"
          handoff_to_coordination:
            - "Pass prepared batch to coordination system"
            - "Provide execution metadata"
            - "Monitor handoff success"

        selection_criteria:
          primary:
            competency_match: "minimum 0.7"
            tfidf_similarity: "minimum 0.6"
            agent_availability: "required"
            performance_history_weight: 0.25
          secondary:
            domain_expertise_matching: "preferred"
            load_balancing: "optimal"
            user_preference_learning: "adaptive"
          fallback:
            competency_match: "minimum 0.5"
            availability_fallback: "allowed"
            master_agent_available: "ultimate_fallback"
          batch_operations:
            operation_count: ">= 3 identical operations"
            independence_check: "required"
            performance_optimization: "prioritized"
            resource_monitoring: "active"
      output:
        batch_plan: "object"
        resource_allocation: "object"
        execution_timeline: "object"
        handoff_status: "object"

    - name: "agent_selection_optimization"
      method: "multi_factor_agent_matching"
      priority: 3
      config:
        selection_algorithm:
          semantic_analysis:
            tfidf_matching: true
            domain_weighting: true
            similarity_scoring: true
            compatibility_filtering: true
          competency_matching:
            vector_comparison: true
            skill_weighting: true
            experience_adjustment: true
            confidence_calculation: true
          performance_integration:
            historical_metrics: true
            time_decay_factor: 0.95
            success_rate_weighting: true
            reliability_metrics: true
          registry_integration:
            dynamic_discovery: true
            name_resolution: true
            load_balancing: true
            availability_validation: true

        selection_strategies:
          performance_priority:
            weights:
              competency_match: 0.35
              performance_history: 0.45
              tfidf_semantic_similarity: 0.15
              availability: 0.05
            min_confidence: 0.7
            use_case: "Critical tasks requiring quality"
          balanced_selection:
            weights:
              competency_match: 0.45
              performance_history: 0.25
              tfidf_semantic_similarity: 0.20
              availability: 0.10
            min_confidence: 0.6
            use_case: "Default strategy for most scenarios"
          availability_priority:
            weights:
              competency_match: 0.40
              availability: 0.35
              performance_history: 0.20
              tfidf_semantic_similarity: 0.05
            min_confidence: 0.5
            use_case: "Time-sensitive tasks"
      output:
        selected_agent: "string"
        confidence_score: "float"
        selection_factors: "object"
        fallback_options: "array"

    - name: "task_assignment_execution"
      method: "coordinated_task_distribution"
      priority: 4
      config:
        assignment_procedure:
          initial_assignment:
            agent_selection: true
            fallback_strategies: true
            assignment_metadata: true
            status_tracking: true
          validation_adjustment:
            capability_alignment: true
            availability_check: true
            confidence_validation: true
            adaptive_adjustments: true
          final_assignment:
            comprehensive_summaries: true
            tailored_instructions: true
            timeout_setting: true
            fallback_contact: true
            agent_instructions_format:
              task_context: "detailed_task_description"
              expected_outcomes: "clear_deliverables"
              constraints: "resource_and_time_limits"
              coordination_needs: "collaboration_requirements"
              fallback_contacts: "escalation_procedures"
        error_handling:
          retry_strategies:
            max_retries: 3
            retry_delays: [1000, 2000, 4000]
            backoff_strategy: "exponential"
            escalation_threshold: 2
          recovery_actions:
            agent_unresponsive: "select_alternative_agent"
            task_timeout: "redefine_scope_and_retry"
            quality_failure: "request_revision_with_feedback"
            system_failure: "fallback_to_master_agent"
        execution_report_structure:
          execution_timeline: "detailed_task_progress"
          performance_metrics: "quality_and_efficiency_scores"
          fallback_activations: "backup_system_usage"
          quality_assessment: "result_validation_results"
          lessons_learned: "improvement_opportunities"

        agent_instructions_format:
          standard_fields:
            - "agent_name"
            - "task_description"
            - "task_context"
            - "specific_requirements"
            - "time_limit_seconds"
            - "contact_for_issues"

        error_handling:
          invalid_assignment:
            recovery: "re-run_selection_with_adjusted_criteria"
            logging: "assignment_failure_details_for_learning"
            fallback: "alternative_approaches"
      output:
        finalized_assignments: "object"
        confidence_score: "float"
        assignment_metadata: "object"
        execution_plan: "object"

    - name: "fallback_system_management"
      method: "intelligent_failure_recovery"
      priority: 5
      config:
        automatic_fallback:
          primary_engine_failure:
            action: "activate_backup_engine"
            triggers: ["primary_engine_timeout", "primary_engine_error", "system_overload", "critical_failure"]
            backup_engine_available: true
          agent_unavailable:
            action: "select_alternative_agent"
            options:
              lower_confidence_threshold: 0.1
              enable_cross_domain_fallback: true
              use_master_agent_as_last_resort: true
              fallback_to_claude_native: true
          all_agents_busy:
            action: "queue_management"
            options:
              priority_queue: true
              wait_time_limit: 300
              escalation_threshold: 2
              use_claude_parallel: true
              notify_user_of_delay: false
          selection_timeout:
            action: "emergency_selection"
            options:
              ignore_load_constraints: true
              minimum_acceptance_score: 0.3
              select_least_loaded_available: true
              fallback_to_claude_direct: true
          delegation_failure:
            action: "error_recovery_protocol"
            options:
              analyze_failure_cause: true
              apply_retry_logic: true
              use_master_direct: true
              escalate_if_persistently_failing: true

        retry_strategies:
          automatic_retry:
            enabled: true
            max_retries: 3
            retry_delays: [1000, 2000, 4000]
            retry_base_delay: 1000
            exponential_backoff: true
          graceful_degradation:
            enabled: true
            performance_impact_reduction: true
            capability_preservation: true
            user_notification: "strategic_error_communication"
          error_reporting:
            detailed_logging: true
            context_capture: true
            learning_integration: true
            user_notification: false
      output:
        fallback_status: "object"
        recovery_actions: "array"
        retry_attempts: "integer"
        error_details: "object"

    - name: "performance_monitoring"
      method: "comprehensive_metrics_tracking"
      priority: 6
      config:
        target_metrics:
          delegation_success_rate: 0.90
          average_response_time: 15000  # 15 seconds
          quality_improvement: 0.20
          system_availability: 0.99
          fallback_usage_rate: 0.10

        batch_operation_metrics:
          parallel_execution_efficiency: 0.85
          batch_completion_rate: 0.95
          concurrent_operation_success: 0.90
          time_reduction_achieved: 0.60
          resource_utilization_optimization: 0.80

        learning_metrics:
          pattern_recognition: "selection_accuracy_improvement"
          preference_learning: "user_preference_adaptation"
          performance_adaptation: "system_optimization_progress"
          success_rate_improvement: "delegation_success_over_time"

        monitoring_frequency:
          real_time_metrics: true
          batch_analysis: true
          performance_trends: true
          learning_updates: true
      output:
        performance_data: "object"
        success_metrics: "object"
        efficiency_scores: "object"
        learning_insights: "object"

dependencies:
  required:
    - component: "agent_selection"
      version: ">=1.0.0"
      reason: "Intelligent agent selection with TF-IDF analysis"
    - component: "task_analysis"
      version: ">=1.0.0"
      reason: "Task complexity and batch detection"
  optional:
    - component: "coordination"
      version: ">=1.0.0"
      fallback: "basic_coordination"
    - component: "clarification"
      version: ">=1.0.0"
      fallback: "skip_clarification"

output:
  format: "structured"
  validation: true
  schema:
    delegation_result: "object"
    batch_delegation_result: "object"
    detailed_execution_report: "object"
    performance_metrics: "object"

fallback:
  enabled: true
  strategy: "multi_level_fallback"
  levels:
    basic_delegation:
      description: "Simple agent assignment without optimization"
      confidence_threshold: 0.6
      capabilities: ["agent_selection", "basic_coordination", "error_handling"]
    enhanced_delegation:
      description: "Full delegation with optimization and fallbacks"
      confidence_threshold: 0.8
      capabilities: ["intelligent_selection", "batch_processing", "performance_monitoring", "adaptive_fallbacks"]
    emergency_mode:
      description: "Master agent direct execution"
      confidence_threshold: 0.4
      capabilities: ["master_execution", "basic_coordination", "minimal_features"]
  recovery:
    automatic: true
    check_interval: 10000  # 10 seconds
    max_attempts: 3

monitoring:
  enabled: true
  metrics:
    - "delegation_success_rate"
    - "agent_selection_accuracy"
    - "batch_operation_efficiency"
    - "fallback_activation_frequency"
    - "performance_improvement"
    - "user_satisfaction"
  performance_targets:
    delegation_success_rate: 0.90
    average_response_time: 15000  # ms
    batch_efficiency: 0.85
    fallback_frequency: 0.10
    quality_improvement: 0.20

integration:
  inputs:
    - "todo_engine"
    - "agent_selection_system"
    - "task_analysis_results"
    - "batch_detection_results"
    - "agent_registry"
  outputs:
    - "orchestration_engine"
    - "coordination_system"
    - "learning_system"
    - "monitoring_system"
    - "user_interface"
  events:
    - subscribe: "delegation_requested"
    - subscribe: "batch_operations_detected"
    - subscribe: "agent_selection_completed"
    - publish: "delegation_completed"
    - publish: "execution_assigned"
    - publish: "fallback_activated"

# Quality Assurance System
quality_assurance:
  validation_rules:
    delegation_criteria: "proper activation thresholds and factor weighting"
    agent_selection: "accurate matching with confidence scoring"
    batch_preparation: "thorough independence validation and resource allocation"
    task_assignment: "comprehensive assignment with proper instructions"
    fallback_system: "reliable failure detection and recovery mechanisms"

  consistency_checks:
    selection_accuracy: true
    assignment_completeness: true
    fallback_reliability: true
    performance_monitoring: true
    integration_validity: true

  performance_standards:
    delegation_processing: "< 15 seconds"
    agent_selection: "< 5 seconds"
    batch_preparation: "< 10 seconds"
    fallback_activation: "< 3 seconds"
    assignment_generation: "< 2 seconds"