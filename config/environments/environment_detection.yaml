# Environment Detection Logic
# Automatic environment detection and configuration loading

detection:
  # Priority order for detection methods
  methods:
    - "environment_variable"
    - "system_property"
    - "profile_file"
    - "hostname_pattern"
    - "default_fallback"

  # Environment variable detection
  environment_variable:
    primary: "APP_ENV"
    alternatives: ["ENVIRONMENT", "NODE_ENV", "SPRING_PROFILES_ACTIVE"]
    case_sensitive: false

  # System property detection
  system_property:
    primary: "app.environment"
    alternatives: ["environment", "env", "profile"]

  # Profile file detection
  profile_file:
    path: "./config/profile"
    fallback_paths: ["./.env", "./profile"]

  # Hostname pattern detection
  hostname_patterns:
    production:
      - "prod-.*"
      - ".*-prod"
      - "production.*"
      - "live.*"

    development:
      - "dev-.*"
      - ".*-dev"
      - "development.*"
      - "local.*"
      - "localhost"

    testing:
      - "test-.*"
      - ".*-test"
      - "testing.*"
      - "ci.*"
      - "jenkins.*"
      - "github-actions"

# Environment validation rules
validation:
  required_fields:
    - "name"
    - "type"
    - "version"

  field_validation:
    name:
      type: "string"
      pattern: "^[a-z][a-z0-9_-]*$"
      max_length: 50

    type:
      type: "string"
      allowed_values: ["development", "production", "testing", "staging"]

    version:
      type: "string"
      pattern: "^\\d+\\.\\d+\\.\\d+$"

# Default fallback environment
default_fallback:
  name: "development"
  reason: "safe_default_for_local_development"

# Environment switching logic
switching:
  # Hot reload configuration changes
  hot_reload:
    enabled: true
    requires_restart: false
    affected_components: ["logging", "metrics", "caching"]

  # Graceful switching
  graceful:
    enabled: true
    timeout: 30
    rollback_on_failure: true

  # Validation after switch
  post_switch_validation:
    health_check: true
    configuration_test: true
    connectivity_test: true

# Environment inheritance
inheritance:
  base_environment: "development"
  override_strategy: "deep_merge"
  array_merge_strategy: "replace"

# Environment-specific overrides
overrides:
  # Development overrides for specific scenarios
  development_overrides:
    debug_mode:
      ci: false
      local: true

    hot_reload:
      ci: false
      local: true

    verbose_logging:
      ci: true
      local: true

  # Production overrides for different regions
  production_overrides:
    eu_west:
      data_residency: "eu"
      backup_location: "eu_central"

    us_east:
      data_residency: "us"
      backup_location: "us_west"

# Environment detection cache
cache:
  enabled: true
  ttl: 300
  cache_key: "environment_detection_result"

# Error handling
error_handling:
  detection_failure:
    action: "use_default"
    log_level: "WARN"
    alert: false

  validation_failure:
    action: "fallback_to_development"
    log_level: "ERROR"
    alert: true

  switching_failure:
    action: "rollback"
    log_level: "ERROR"
    alert: true

# Monitoring
monitoring:
  metrics:
    detection_time: true
    switching_time: true
    validation_time: true
    failure_count: true

  logging:
    detection_events: true
    switching_events: true
    validation_events: true
    error_events: true