# Sequenced System Initialization Configuration
# Defines the order and dependencies for system startup

metadata:
  name: "sequenced-initialization"
  version: "1.0.0"
  description: "Enhanced system initialization with proper sequencing and fallback mechanisms"
  author: "Master Agent System v3.6.1"

# Initialization Phases Configuration
initialization_phases:
  phase_1_core_systems:
    name: "Core Systems Initialization"
    priority: "critical"
    timeout: 45  # seconds
    description: "Initialize critical error handling and recovery systems"

    load_order:
      - config: "config/core/unified_error_handling.yaml"
        required: true
        fallback_config: "builtin_error_handling"
        timeout: 15

    validation:
      required_functions:
        - "error_handling_active"
        - "fallback_ready"
        - "recovery_systems_ready"

      success_criteria:
        - error_handling_status: "active"
        - fallback_mechanisms: "ready"
        - claude_fallback: "available"

    failure_actions:
      - "activate_emergency_fallback"
      - "use_builtin_error_handling"
      - "continue_with_minimal_functionality"

  phase_2_knowledge_base:
    name: "Knowledge Base Initialization"
    priority: "high"
    timeout: 60
    depends_on: "phase_1_core_systems"
    description: "Initialize core knowledge and analysis systems"

    load_order:
      - config: "config/knowledge-base/task-analysis.yaml"
        required: true
        fallback_config: "builtin_task_analysis"
        timeout: 15

      - config: "config/knowledge-base/unified_agent_selection.yaml"
        required: true
        depends_on: "task-analysis.yaml"
        fallback_config: "builtin_agent_selection"
        timeout: 10

      - config: "config/knowledge-base/categorization-engine.yaml"
        required: true
        depends_on: ["task-analysis.yaml", "unified_agent_selection.yaml"]
        fallback_config: "builtin_categorization"
        timeout: 10

      - config: "config/knowledge-base/clarification_system.yaml"
        required: true
        depends_on: ["task-analysis.yaml", "tfidf-system.yaml", "categorization-engine.yaml"]
        fallback_config: "builtin_clarification"
        timeout: 15

    validation:
      required_functions:
        - "task_analysis_ready"
        - "agent_selection_ready"
        - "categorization_ready"

      success_criteria:
        - task_analysis_status: "operational"
        - agent_selection_status: "operational"
        - dependencies_resolved: true

    failure_actions:
      - "enable_degraded_mode"
      - "use_fallback_configs"
      - "continue_with_basic_functionality"

  phase_3_dynamic_configuration:
    name: "Dynamic Configuration Initialization"
    priority: "high"
    timeout: 75
    depends_on: "phase_2_knowledge_base"
    description: "Initialize dynamic agent discovery and system configuration"

    load_order:
      - config: "config/dynamic/agent_types.yaml"
        required: true
        fallback_config: "builtin_agent_types"
        timeout: 10

      - config: "config/dynamic/dynamic_agent_discovery.yaml"
        required: true
        depends_on: "agent_types.yaml"
        fallback_config: "builtin_discovery"
        timeout: 15

      - config: "config/dynamic/mcp_registry.yaml"
        required: true
        depends_on: "dynamic_agent_discovery.yaml"
        fallback_config: "builtin_mcp_registry"
        timeout: 10

      - config: "config/dynamic/domain_system.yaml"
        required: false
        depends_on: "dynamic_agent_discovery.yaml"
        fallback_config: "builtin_domain_system"
        timeout: 10

      # Additional dynamic configs (parallel loading)
      parallel_configs:
        - config: "config/dynamic/time_estimation.yaml"
          fallback_config: "builtin_time_estimation"
          timeout: 5

        - config: "config/dynamic/performance_tracking.yaml"
          fallback_config: "builtin_performance_tracking"
          timeout: 5

        - config: "config/dynamic/integrated_environment_config.yaml"
          fallback_config: "builtin_environment_config"
          timeout: 5

        - config: "config/dynamic/unified_metrics.yaml"
          fallback_config: "builtin_metrics"
          timeout: 5

    validation:
      required_functions:
        - "agent_discovery_ready"
        - "mcp_registry_ready"

      success_criteria:
        - agent_discovery_status: "operational"
        - mcp_registry_status: "operational"
        - dynamic_configs_loaded: ">=80%"

    failure_actions:
      - "use_hardcoded_agent_list"
      - "enable_basic_mcp_tools"
      - "continue_with_limited_discovery"

  phase_4_system_integration:
    name: "System Integration and Validation"
    priority: "critical"
    timeout: 30
    depends_on: ["phase_1_core_systems", "phase_2_knowledge_base", "phase_3_dynamic_configuration"]
    description: "Validate system integration and prepare for operation"

    integration_tasks:
      - name: "validate_all_components"
        required: true
        timeout: 10

      - name: "initialize_agent_discovery"
        required: true
        timeout: 10

      - name: "setup_task_analysis_system"
        required: true
        timeout: 5

      - name: "setup_agent_selection_system"
        required: true
        timeout: 5

    final_validation:
      system_health_checks:
        - error_handling: "operational"
        - agent_discovery: ">=1_agent_found"
        - task_analysis: "functional"
        - agent_selection: "functional"

      operational_readiness:
        - minimal_agents: ">=1"
        - preferred_agents: ">=3"
        - fallback_systems: "ready"
        - error_recovery: "tested"

  phase_5_agent_discovery:
    name: "Dynamic Agent Discovery and Registration"
    priority: "high"
    timeout: 60
    depends_on: ["phase_1_core_systems", "phase_2_knowledge_base", "phase_3_dynamic_configuration", "phase_4_system_integration"]
    description: "Discover, validate and register available agents"

    discovery_process:
      - step: "Query filesystem for available agents"
        config: "config/dynamic/dynamic_agent_discovery.yaml"
        timeout: 15
        error_recovery: "continue_even_if_fails"

      - step: "Dynamically discover agents from filesystem and built-in defaults"
        scan_paths: ["agents/"]
        file_patterns: ["*.md"]
        timeout: 10

      - step: "Validate agent name format"
        validation: "simple-name (from YAML frontmatter)"
        timeout: 5
        fallback: "provide_suggestions_for_invalid_names"

      - step: "Auto-registration and caching"
        actions: ["cache_discovered_agents", "auto_register_agents"]
        timeout: 10
        fallback: "use_hardcoded_master_agent"

    validation:
      required_functions:
        - "agent_discovery_active"
        - "agent_validation_ready"
        - "fallback_agent_available"

      success_criteria:
        - agents_discovered: ">=1"
        - master_agent_available: true
        - validation_systems: "operational"

    failure_actions:
      - "activate_master_agent_fallback"
      - "use_hardcoded_agent_list"
      - "continue_with_minimal_functionality"
      - "log_discovery_failure"

    fallback_configurations:
      master_agent_fallback:
        description: "Always have master agent available as last resort"
        priority: "critical"
        actions: ["register_master_agent", "enable_basic_functionality"]

      emergency_agents:
        default_agents: ["master"]
        capabilities: ["basic_orchestration", "native_execution"]

phase_6_task_analysis_systems:
    name: "Task Analysis and TF-IDF Systems"
    priority: "high"
    timeout: 45
    depends_on: ["phase_5_agent_discovery"]
    description: "Initialize task analysis, TF-IDF processing and categorization systems"

    load_order:
      - config: "config/knowledge-base/task-analysis.yaml"
        required: true
        fallback_config: "builtin_task_analysis"
        timeout: 15

      - config: "config/knowledge-base/tfidf-system.yaml"
        required: true
        fallback_config: "builtin_tfidf"
        timeout: 10

      - config: "config/knowledge-base/categorization-engine.yaml"
        required: true
        depends_on: ["task-analysis.yaml", "tfidf-system.yaml"]
        fallback_config: "builtin_categorization"
        timeout: 10

      - config: "config/knowledge-base/clarification_system.yaml"
        required: true
        depends_on: ["task-analysis.yaml", "tfidf-system.yaml", "categorization-engine.yaml"]
        fallback_config: "builtin_clarification"
        timeout: 15

    validation:
      required_functions:
        - "task_analysis_ready"
        - "tfidf_processing_active"
        - "categorization_operational"
        - "clarification_available"

      success_criteria:
        - task_analysis_status: "operational"
        - tfidf_status: "active"
        - categorization_status: "operational"
        - clarification_status: "active"
        - analysis_quality: ">=85%"

    failure_actions:
      - "enable_basic_task_analysis"
      - "use_keyword_extraction_fallback"
      - "disable_advanced_categorization"
      - "continue_with_simplified_analysis"

  phase_7_agent_selection_systems:
    name: "Agent Selection and Matching Systems"
    priority: "high"
    timeout: 30
    depends_on: ["phase_6_task_analysis_systems", "phase_5_agent_discovery"]
    description: "Initialize intelligent agent selection and matching systems"

    load_order:
      - config: "config/knowledge-base/unified_agent_selection.yaml"
        required: true
        fallback_config: "builtin_agent_selection"
        timeout: 10

      - config: "config/dynamic/domain_system.yaml"
        required: false
        fallback_config: "builtin_domain_system"
        timeout: 5

      - config: "config/dynamic/time_estimation.yaml"
        required: false
        fallback_config: "builtin_time_estimation"
        timeout: 5

    validation:
      required_functions:
        - "agent_selection_ready"
        - "matching_algorithm_active"
        - "scoring_system_operational"

      success_criteria:
        - selection_status: "operational"
        - matching_quality: ">=90%"
        - scoring_accuracy: ">=85%"

    failure_actions:
      - "use_basic_agent_selection"
      - "fallback_to_master_agent"
      - "disable_intelligent_matching"
      - "continue_with_simple_selection"

  phase_8_execution_systems:
    name: "Task Execution and Coordination Systems"
    priority: "high"
    timeout: 45
    depends_on: ["phase_7_agent_selection_systems"]
    description: "Initialize task execution, parallel coordination and TODO-EXECUTION engine"

    load_order:
      - config: "config/knowledge-base/parallel_coordination.yaml"
        required: true
        fallback_config: "builtin_coordination"
        timeout: 10

      - config: "config/knowledge-base/todo_execution_engine.yaml"
        required: true
        fallback_config: "builtin_todo_execution"
        timeout: 15

      - config: "config/dynamic/mcp_registry.yaml"
        required: true
        fallback_config: "builtin_mcp_registry"
        timeout: 10

    validation:
      required_functions:
        - "coordination_ready"
        - "todo_execution_active"
        - "mcp_registry_operational"
        - "task_delegation_ready"

      success_criteria:
        - coordination_status: "operational"
        - todo_execution_status: "active"
        - mcp_tools_available: ">=5"
        - delegation_success_rate: ">=90%"

    failure_actions:
      - "enable_sequential_execution"
      - "use_native_task_execution"
      - "disable_parallel_coordination"
      - "fallback_to_direct_execution"

  phase_9_monitoring_systems:
    name: "Monitoring and Performance Systems"
    priority: "medium"
    timeout: 30
    depends_on: ["phase_8_execution_systems"]
    description: "Initialize performance tracking, monitoring and learning systems"

    load_order:
      - config: "config/dynamic/performance_tracking.yaml"
        required: false
        fallback_config: "builtin_performance_tracking"
        timeout: 10

      - config: "config/dynamic/integrated_environment_config.yaml"
        required: false
        fallback_config: "builtin_environment_config"
        timeout: 5

      - config: "config/dynamic/unified_metrics.yaml"
        required: false
        fallback_config: "builtin_metrics"
        timeout: 5

    validation:
      required_functions:
        - "monitoring_active"
        - "metrics_collection_ready"

      success_criteria:
        - monitoring_status: "operational"
        - metrics_quality: ">=80%"

    failure_actions:
      - "enable_basic_monitoring"
      - "use_builtin_metrics"
      - "continue_without_advanced_tracking"

  phase_10_system_ready:
    name: "Final System Readiness and Validation"
    priority: "critical"
    timeout: 30
    depends_on: ["phase_1_core_systems", "phase_2_knowledge_base", "phase_3_dynamic_configuration", "phase_4_system_integration", "phase_5_agent_discovery", "phase_6_task_analysis_systems", "phase_7_agent_selection_systems", "phase_8_execution_systems"]
    description: "Final validation and system readiness confirmation"

    final_validation:
      system_health_checks:
        - error_handling: "operational"
        - agent_discovery: ">=1_agent_found"
        - task_analysis: "functional"
        - agent_selection: "functional"
        - execution_systems: "operational"

      operational_readiness:
        - minimal_functionality: ">=80%"
        - preferred_functionality: ">=60%"
        - fallback_systems: "ready"
        - error_recovery: "tested"
        - performance_baseline: "established"

    completion_actions:
      - "log_initialization_success"
      - "activate_monitoring"
      - "enable_learning_systems"
      - "provide_system_status_report"

# Fallback Configuration Templates
fallback_configurations:
  builtin_error_handling:
    critical_errors: ["system_failure", "agent_unavailable", "configuration_corruption"]
    recovery_strategies: ["claude_native_fallback", "graceful_degradation", "emergency_mode"]
    timeout_values:
      error_detection: 5
      recovery_execution: 30
      fallback_activation: 10

  builtin_task_analysis:
    complexity_thresholds:
      simple: 1
      moderate: 2
      complex: 3
      enterprise: 4

    default_categories:
      - "development"
      - "analysis"
      - "infrastructure"
      - "quality"

  builtin_agent_selection:
    default_agents:
      master:
        category: "orchestration"
        capabilities: ["task-orchestration", "coordination"]
        priority: "critical"

  builtin_discovery:
    scan_paths: ["agents/", "subagents/"]
    file_patterns: ["*.md"]
    default_agents: ["master"]

  builtin_clarification:
    max_questions: 3
    timeout_per_question: 30
    fallback_to_execution: true

# Error Handling and Recovery
error_handling:
  phase_failure_handling:
    critical_phase_failure:
      action: "activate_emergency_mode"
      continue_execution: true
      fallback_to_builtin: true

    high_priority_phase_failure:
      action: "enable_degraded_mode"
      continue_execution: true
      log_level: "error"

    optional_phase_failure:
      action: "skip_component"
      continue_execution: true
      log_level: "warning"

  recovery_strategies:
    emergency_mode:
      description: "Minimal functionality with Claude Code native tools"
      available_capabilities: ["basic_task_execution", "file_operations", "web_search"]

    degraded_mode:
      description: "Limited functionality with core features"
      available_capabilities: ["agent_selection", "task_delegation", "basic_coordination"]

    fallback_mode:
      description: "Reduced functionality with alternative configurations"
      available_capabilities: ["hardcoded_agents", "basic_task_analysis", "simple_selection"]

# Performance Monitoring
monitoring:
  initialization_metrics:
    - "phase_completion_times"
    - "config_load_success_rate"
    - "fallback_activation_count"
    - "error_recovery_time"
    - "overall_initialization_time"

  health_checks:
    interval: 300  # 5 minutes
    checks:
      - "error_handling_status"
      - "agent_availability"
      - "config_consistency"
      - "fallback_readiness"

# Configuration Updates
dynamic_updates:
  auto_reload:
    enabled: true
    trigger: "file_system_change"
    validation_required: true

  hot_reload:
    supported_configs: [
      "config/dynamic/performance_tracking.yaml",
      "config/dynamic/unified_metrics.yaml"
    ]
    validation_required: false

  full_reload_required:
    triggers: [
      "config/core/unified_error_handling.yaml",
      "config/dynamic/dynamic_agent_discovery.yaml",
      "config/knowledge-base/unified_agent_selection.yaml"
    ]
    requires_restart: true