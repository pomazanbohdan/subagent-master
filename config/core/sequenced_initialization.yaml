# Sequenced System Initialization Configuration
# Defines the order and dependencies for system startup

metadata:
  name: "sequenced-initialization"
  version: "1.0.0"
  description: "Enhanced system initialization with proper sequencing and fallback mechanisms"
  author: "Master Agent System v3.6.1"

# Initialization Phases Configuration
initialization_phases:
  phase_1a_critical_core:
    name: "Critical Core Initialization"
    priority: "critical"
    timeout: 30  # seconds
    fallback_timeout: 10

    load_order:
      - config: "config/core/unified_error_handling.yaml"
        required: true
        fallback_config: "builtin_error_handling"
        timeout: 10

    validation:
      required_functions:
        - "error_handling_active"
        - "fallback_ready"
        - "recovery_systems_ready"

      success_criteria:
        - error_handling_status: "active"
        - fallback_mechanisms: "ready"
        - claude_fallback: "available"

    failure_actions:
      - "activate_emergency_fallback"
      - "use_builtin_error_handling"
      - "continue_with_minimal_functionality"

  phase_1b_knowledge_base:
    name: "Knowledge Base Initialization"
    priority: "high"
    timeout: 45
    depends_on: "phase_1a_critical_core"

    load_order:
      - config: "config/knowledge-base/task-analysis.yaml"
        required: true
        fallback_config: "builtin_task_analysis"
        timeout: 15

      - config: "config/knowledge-base/unified_agent_selection.yaml"
        required: true
        depends_on: "task-analysis.yaml"
        fallback_config: "builtin_agent_selection"
        timeout: 10

      - config: "config/knowledge-base/categorization-engine.yaml"
        required: true
        depends_on: ["task-analysis.yaml", "unified_agent_selection.yaml"]
        fallback_config: "builtin_categorization"
        timeout: 10

      - config: "config/knowledge-base/clarification_system.yaml"
        required: false
        depends_on: "categorization-engine.yaml"
        fallback_config: "builtin_clarification"
        timeout: 10

    validation:
      required_functions:
        - "task_analysis_ready"
        - "agent_selection_ready"
        - "categorization_ready"

      success_criteria:
        - task_analysis_status: "operational"
        - agent_selection_status: "operational"
        - dependencies_resolved: true

    failure_actions:
      - "enable_degraded_mode"
      - "use_fallback_configs"
      - "continue_with_basic_functionality"

  phase_1c_dynamic_configuration:
    name: "Dynamic Configuration Initialization"
    priority: "high"
    timeout: 60
    depends_on: "phase_1b_knowledge_base"

    load_order:
      - config: "config/dynamic/agent_types.yaml"
        required: true
        fallback_config: "builtin_agent_types"
        timeout: 10

      - config: "config/dynamic/dynamic_agent_discovery.yaml"
        required: true
        depends_on: "agent_types.yaml"
        fallback_config: "builtin_discovery"
        timeout: 15

      - config: "config/dynamic/mcp_registry.yaml"
        required: true
        depends_on: "dynamic_agent_discovery.yaml"
        fallback_config: "builtin_mcp_registry"
        timeout: 10

      - config: "config/dynamic/domain_system.yaml"
        required: false
        depends_on: "dynamic_agent_discovery.yaml"
        fallback_config: "builtin_domain_system"
        timeout: 10

      # Additional dynamic configs (parallel loading)
      parallel_configs:
        - config: "config/dynamic/time_estimation.yaml"
          fallback_config: "builtin_time_estimation"
          timeout: 5

        - config: "config/dynamic/performance_tracking.yaml"
          fallback_config: "builtin_performance_tracking"
          timeout: 5

        - config: "config/dynamic/integrated_environment_config.yaml"
          fallback_config: "builtin_environment_config"
          timeout: 5

        - config: "config/dynamic/unified_metrics.yaml"
          fallback_config: "builtin_metrics"
          timeout: 5

    validation:
      required_functions:
        - "agent_discovery_ready"
        - "mcp_registry_ready"

      success_criteria:
        - agent_discovery_status: "operational"
        - mcp_registry_status: "operational"
        - dynamic_configs_loaded: ">=80%"

    failure_actions:
      - "use_hardcoded_agent_list"
      - "enable_basic_mcp_tools"
      - "continue_with_limited_discovery"

  phase_1d_integration_validation:
    name: "System Integration and Validation"
    priority: "critical"
    timeout: 30
    depends_on: ["phase_1a_critical_core", "phase_1b_knowledge_base", "phase_1c_dynamic_configuration"]

    integration_tasks:
      - name: "validate_all_components"
        required: true
        timeout: 10

      - name: "initialize_agent_discovery"
        required: true
        timeout: 10

      - name: "setup_task_analysis_system"
        required: true
        timeout: 5

      - name: "setup_agent_selection_system"
        required: true
        timeout: 5

    final_validation:
      system_health_checks:
        - error_handling: "operational"
        - agent_discovery: ">=1_agent_found"
        - task_analysis: "functional"
        - agent_selection: "functional"

      operational_readiness:
        - minimal_agents: ">=1"
        - preferred_agents: ">=3"
        - fallback_systems: "ready"
        - error_recovery: "tested"

# Fallback Configuration Templates
fallback_configurations:
  builtin_error_handling:
    critical_errors: ["system_failure", "agent_unavailable", "configuration_corruption"]
    recovery_strategies: ["claude_native_fallback", "graceful_degradation", "emergency_mode"]
    timeout_values:
      error_detection: 5
      recovery_execution: 30
      fallback_activation: 10

  builtin_task_analysis:
    complexity_thresholds:
      simple: 1
      moderate: 2
      complex: 3
      enterprise: 4

    default_categories:
      - "development"
      - "analysis"
      - "infrastructure"
      - "quality"

  builtin_agent_selection:
    default_agents:
      master:
        category: "orchestration"
        capabilities: ["task-orchestration", "coordination"]
        priority: "critical"

  builtin_discovery:
    scan_paths: ["agents/", "subagents/"]
    file_patterns: ["*.md"]
    default_agents: ["master"]

  builtin_clarification:
    max_questions: 3
    timeout_per_question: 30
    fallback_to_execution: true

# Error Handling and Recovery
error_handling:
  phase_failure_handling:
    critical_phase_failure:
      action: "activate_emergency_mode"
      continue_execution: true
      fallback_to_builtin: true

    high_priority_phase_failure:
      action: "enable_degraded_mode"
      continue_execution: true
      log_level: "error"

    optional_phase_failure:
      action: "skip_component"
      continue_execution: true
      log_level: "warning"

  recovery_strategies:
    emergency_mode:
      description: "Minimal functionality with Claude Code native tools"
      available_capabilities: ["basic_task_execution", "file_operations", "web_search"]

    degraded_mode:
      description: "Limited functionality with core features"
      available_capabilities: ["agent_selection", "task_delegation", "basic_coordination"]

    fallback_mode:
      description: "Reduced functionality with alternative configurations"
      available_capabilities: ["hardcoded_agents", "basic_task_analysis", "simple_selection"]

# Performance Monitoring
monitoring:
  initialization_metrics:
    - "phase_completion_times"
    - "config_load_success_rate"
    - "fallback_activation_count"
    - "error_recovery_time"
    - "overall_initialization_time"

  health_checks:
    interval: 300  # 5 minutes
    checks:
      - "error_handling_status"
      - "agent_availability"
      - "config_consistency"
      - "fallback_readiness"

# Configuration Updates
dynamic_updates:
  auto_reload:
    enabled: true
    trigger: "file_system_change"
    validation_required: true

  hot_reload:
    supported_configs: [
      "config/dynamic/performance_tracking.yaml",
      "config/dynamic/unified_metrics.yaml"
    ]
    validation_required: false

  full_reload_required:
    triggers: [
      "config/core/unified_error_handling.yaml",
      "config/dynamic/dynamic_agent_discovery.yaml",
      "config/knowledge-base/unified_agent_selection.yaml"
    ]
    requires_restart: true