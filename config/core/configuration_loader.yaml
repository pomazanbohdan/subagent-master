# Configuration Loader Configuration
# Clean configuration loading with caching and validation

metadata:
  name: "Configuration Loader"
  description: "Dynamic configuration loading system with hot reload and validation"
  version: "2.5.0"
  configuration_type: "core_loader"

# Core Loading System
loading_system:
  architecture: "lazy_initialization_with_caching"
  cache_strategy: "memory_with_file_system_validation"
  validation_strategy: "schema_based_with_custom_validators"
  reload_strategy: "file_system_watcher_based"
  
  performance:
    max_concurrent_loads: 5
    cache_size_limit: "100MB"
    cache_ttl: 3600  # 1 hour
    reload_debounce_time: 2  # seconds
    reload_timeout: 30  # seconds

# Configuration Schema Definitions
schemas:
  # Agent configuration schema
  agent_schema:
    required_fields:
      - name
      - description
      - capabilities
      - competencies
      - performance
      - capacity
      
    field_validation:
      name:
        type: "string"
        min_length: 1
        max_length: 100
        pattern: "^[a-zA-Z0-9_-]+$"
        
      description:
        type: "string"
        min_length: 10
        max_length: 500
        
      capabilities:
        type: "array"
        min_items: 1
        max_items: 20
        item_type: "string"
        
      competencies:
        type: "object"
        validation: "competency_score_validation"
        
      performance:
        type: "object"
        required_subfields:
          - success_rate
          - avg_response_time
          - reliability
        validation: "performance_metrics_validation"
        
      capacity:
        type: "object"
        required_subfields:
          - max_concurrent_tasks
          - current_load
          load_factor

# Loading Algorithms
loading_algorithms:
  configuration_loader:
    implementation: |
      # Configuration Loading Algorithm
      INPUT: config_path, config_type, validate_immediately, cache_result
      
      PROCESS:
      1. Cache Check:
          - Check cache for existing configuration
          - Validate cache validity
          - Return cached configuration if valid
        
      2. File System Load:
          - Load YAML from file system
          - Parse YAML content
          - Validate configuration format
          - Cache successful loads
        
      3. Validation:
          - Apply schema validation if required
          - Validate field structures and constraints
          - Apply custom validators
          - Report validation results
        
      4. Cache Update:
          - Save valid configuration to cache
          - Update cache metadata
          - Setup file watcher for hot reload
          - Notify successful load
        
      OUTPUT: configuration data structure with metadata
        
    error_handling:
      Fallback to last_valid_configuration when errors occur
      Continue with degraded functionality if possible

  hot_reload_mechanism:
    implementation: |
      # Hot Reload Algorithm
      INPUT: config_path, config_type, reload_callback
      
      PROCESS:
      1. Initialize file watcher
      2. Add configuration path to watcher
      3. Define reload handler for modified files
      4. Start watching
      
      ERROR_RECOVERY:
      - Continue with last valid configuration if hot reload fails
      - Log error and continue with current configuration

  cache_management:
    caching_enabled: true
    cache_type: "memory_with_file_backup"
    cache_size_limit: "100MB"
    cache_ttl: 3600
    backup_interval: 300
    cache_persistence: true
    
    caching_logic:
      cache_on_load: true
      cache_on_success: true
      cache_on_failure: false
      cache_on_validation_success: true

# Configuration Validation
validation:
  competency_score_validation:
    implementation: |
      # Competency Score Validation Algorithm
      INPUT: competencies (object)
      OUTPUT: Validation result or ValidationError
      
      PROCESS:
      1. Validate score range
      for competency, score in competencies.items():
        if not 0.0 <= score <= 1.0:
          raise ValidationError("Competency score must be between 0.0 and 1.0")
      
      return True

  performance_metrics_validation:
    implementation: |
      # Performance Metrics Validation Algorithm
      INPUT: performance (object)
      OUTPUT: Validation result
      
      PROCESS:
      1. Validate required metrics
      2. Check metric ranges
      3. Apply business logic
      4. Validate consistency
      
      REQUIRED_METRICS:
      - success_rate: [0.0, 1.0]
      - avg_response_time: [0.0, 300.0]
      - reliability: [0.0, 1.0]
      
      VALIDATION_RULES:
      - Performance threshold met: success_rate >= 0.7
      - Time threshold met: avg_response_time <= 30s
      Reliability >= 0.8

# Error Handling
error_handling:
  error_recovery:
    configuration_load_error:
      strategy: "load_from_cache_or_fallback"
      priority: "high"
      confidence_level: "moderate"
      timeout: 60
      
    validation_error:
      strategy: "use_default_config"
      priority: "medium"
      confidence_level: "high"

# Integration Points
integration:
  imports:
    agent_selection_system: "config/knowledge-base/agent-selection.yaml"
    tfidf_system: "config/knowledge-base/tfidf-system.yaml"
    task_analysis: "config/knowledge-base/task-analysis.yaml"
    
  exports:
    configuration_data: "Loaded configuration with metadata"
    cache_status: "Current cache status and effectiveness"
    error_recovery_data: "Fallback configuration data"
    performance_data: "Performance metrics and analysis"