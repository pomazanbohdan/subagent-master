# Agent Selection System (Optimized v1.0.0)
# Agent selection with TF-IDF semantic analysis and competency matching

component:
  name: "agent_selection"
  version: "1.0.0"
  description: "Agent selection system with TF-IDF semantic analysis and competency matching"
  category: "analysis"
  priority: 1  # Critical for task orchestration
  status: "stable"

  triggers:
    primary:
      keywords: ["select_agent", "choose_agent", "agent_selection", "delegate", "orchestrate"]
      patterns: [".*select.*agent.*", ".*delegate.*to.*", ".*which.*agent.*"]
      score: 1.0
    secondary:
      keywords: ["analyze", "coordinate", "manage_task", "complex_task"]
      patterns: [".*complex.*task.*", ".*multiple.*components.*"]
      score: 0.7
    contextual:
      conditions:
        - "task_complexity > 2"
        - "multiple_specializations_required"
        - "automatic_delegation_needed"
      score: 0.5

  implementation:
    operations:
      - name: "task_semantic_analysis"
        method: "tfidf_processing"
        priority: 1
        config:
          tfidf_config:
            max_features: 1000
            min_word_length: 2
            ngram_range: [1, 2]
            similarity_threshold: 0.3
            stop_words: ["the", "a", "an", "and", "or", "but", "in", "on", "at", "to", "for", "of", "with", "by", "is", "are", "was", "were", "be", "been", "have", "has", "had", "do", "does", "did", "will", "would", "could", "should", "may", "might", "can", "must"]
          preprocessing:
            tokenization:
              method: "word_extraction"
              patterns:
                - "Extract alphabetic words and technical terms"
                - "Split on whitespace and punctuation"
                - "Normalize to lowercase"
                - "Filter by minimum word length"
                - "Preserve technical jargon and domain-specific terms"
            normalization:
              - "Convert to lowercase"
              - "Remove punctuation (preserve technical underscores/hyphens)"
              - "Collapse multiple spaces"
              - "Strip leading/trailing whitespace"
              - "Normalize technical terms"
            cleaning:
              - "Remove special characters (preserve technical symbols)"
              - "Handle contractions and abbreviations"
              - "Maintain technical terminology"
              - "Preserve contextual information"
            technical_terms_boost: 1.5
          vectorization:
            vocabulary_building:
              method: "frequency_based_with_technical_bias"
              min_df: 2
              max_df: 0.95
              technical_term_enhancement:
                enabled: true
                technical_domains: ["backend", "frontend", "devops", "security", "testing", "data", "architecture"]
                boost_factor: 1.5
            idf_calculation:
              formula: "log((total_documents + 1) / (document_frequency + 1)) + 1"
              smoothing: true
              base: "natural_log"
              technical_term_adjustment: true
            similarity_calculation:
              method: "cosine_similarity"
              threshold: 0.3
              output_format: "score_with_confidence"
              normalization: "l2"
              confidence_calculation: true
        output:
          semantic_vector: "array"
          domain_indicators: "array"
          technical_terms: "array"

      - name: "competency_matching"
        method: "matrix_scoring"
        priority: 2
        config:
          competency_dimensions:
            technical_skills:
              weight: 0.40
              categories:
                programming_languages: ["python", "javascript", "java", "go", "rust", "typescript"]
                frameworks: ["react", "vue", "angular", "django", "flask", "express", "spring"]
                databases: ["sql", "nosql", "mongodb", "postgresql", "mysql", "redis"]
                cloud_platforms: ["aws", "azure", "gcp", "heroku", "digitalocean"]
                devops_tools: ["docker", "kubernetes", "jenkins", "gitlab", "terraform"]
            domain_knowledge:
              weight: 0.25
              categories:
                software_architecture: ["microservices", "monolith", "serverless", "event-driven"]
                security_practices: ["owasp", "authentication", "authorization", "encryption"]
                performance_optimization: ["caching", "load_balancing", "database_indexing"]
                testing_strategies: ["unit_testing", "integration_testing", "e2e_testing"]
                data_engineering: ["etl", "data_pipeline", "streaming", "batch_processing"]
            problem_solving:
              weight: 0.20
              categories:
                analytical_thinking: ["debugging", "root_cause_analysis", "system_design"]
                creativity: ["innovation", "solution_design", "problem_framing"]
                planning: ["architecture_planning", "roadmap_design", "resource_estimation"]
                execution: ["implementation", "coordination", "quality_assurance"]
            collaboration:
              weight: 0.15
              categories:
                technical_writing: ["documentation", "api_docs", "specifications"]
                stakeholder_communication: ["requirement_gathering", "status_reporting"]
                code_communication: ["code_reviews", "pair_programming", "knowledge_sharing"]
          skill_importance_weights:
            primary_skills: 1.0
            secondary_skills: 0.7
            optional_skills: 0.5
            emerging_skills: 0.3
          experience_adjustment:
            junior_level: 0.7
            mid_level: 0.9
            senior_level: 1.1
            expert_level: 1.3
          scoring_algorithm: "weighted_sum_with_confidence"
        output:
          competency_scores: "object"
          capability_match: "float"

      - name: "performance_weighting"
        method: "historical_analysis"
        priority: 3
        config:
          performance_metrics:
            success_metrics:
              task_completion_rate: 0.4
              quality_score: 0.3
              time_efficiency: 0.2
              error_rate: 0.1
          performance_calculation:
            weighted_average: true
            time_decay_factor: 0.95
            minimum_tasks: 3
            confidence_threshold: 0.6
          learning_adaptation:
            enabled: true
            learning_rate: 0.1
            feedback_integration: true
            performance_trend_analysis: true
        output:
          performance_multiplier: "float"
          confidence_level: "float"

      - name: "selection_algorithm"
        method: "multi_criteria_optimization"
        priority: 4
        config:
          selection_formula:
            semantic_similarity: 0.3
            competency_match: 0.4
            performance_score: 0.3
          optimization_strategy: "maximize_expected_success"
          fallback_enabled: true
        output:
          selected_agent: "string"
          confidence_score: "float"
          alternative_agents: "array"

      - name: "learning_update"
        method: "feedback_processing"
        priority: 5
        config:
          feedback_sources:
            - "task_completion_success"
            - "user_satisfaction"
            - "time_efficiency"
          update_frequency: "weekly"
          model_retraining_threshold: 0.05
        output:
          model_accuracy_improvement: "float"
          pattern_updates: "array"

  dependencies:
    required:
      - component: "task_analysis"
        version: ">=1.0.0"
        reason: "Task complexity assessment for selection"
    optional:
      - component: "performance_tracker"
        version: ">=1.0.0"
        fallback: "use default performance weights"

  output:
    format: "structured"
    validation: true
    schema:
      selected_agent: "string"
      selection_confidence: "float"
      competency_breakdown: "object"
      alternative_options: "array"

  fallback:
    enabled: true
    strategy: "graceful_degradation"
    alternatives:
      - "simple_keyword_matching"
      - "category_based_selection"
      - "round_robin_fallback"
    emergency_only: false

  monitoring:
    enabled: true
    metrics:
      - "selection_accuracy"
      - "user_satisfaction_rate"
      - "task_completion_success"
      - "selection_confidence_correlation"
    performance_targets:
      response_time: 1500  # ms
      accuracy: 0.85
      satisfaction: 0.80

  integration:
    inputs:
      - "task_analysis_results"
      - "task_description"
      - "agent_registry"
    outputs:
      - "delegation_system"
      - "orchestration_engine"
    events:
      - subscribe: "agent_selection_requested"
      - publish: "agent_selected"

# Machine Learning Categorization System
ml_categorization_system:
  ensemble_models:
    keyword_classifier:
      enabled: true
      weight: 0.4
      confidence_threshold: 0.7

    semantic_analyzer:
      enabled: true
      weight: 0.4
      confidence_threshold: 0.6

    pattern_recognizer:
      enabled: true
      weight: 0.2
      confidence_threshold: 0.5

  categorization_domains:
    task_categories:
      - "analysis_research"
      - "design_architecture"
      - "implementation_development"
      - "testing_validation"
      - "deployment_operations"
      - "security_compliance"
      - "documentation_knowledge"
      - "optimization_performance"

    cross_domain_detection:
      enabled: true
      multi_domain_threshold: 0.6
      complexity_adjustment: true

  adaptive_learning:
    feedback_integration: true
    model_retraining: "weekly"
    performance_tracking: true
    confidence_calibration: true

# Quality Assurance System
quality_assurance_system:
  validation_rules:
    minimum_confidence: 0.6
    max_candidates: 3
    min_semantic_similarity: 0.3
    max_complexity_mismatch: 1.5
    min_competency_match: 0.4

  quality_gates:
    - All selected agents must meet minimum confidence threshold
    - At least one agent must exceed 0.8 confidence for critical tasks
    - Semantic similarity must be > 0.4 for complex tasks
    - Performance score must be > 0.6 for high-priority tasks
    - Competency match must be > 0.5 for specialized tasks

  performance_thresholds:
    min_success_rate: 0.7
    max_response_time: 10.0
    min_reliability: 0.8
    max_load_ratio: 0.8
    min_availability: 0.2

# Enhanced Selection Strategies
selection_strategies:
  default_balanced:
    name: "balanced_selection"
    description: "Balanced approach with competency, performance, and semantic analysis"
    weights:
      competency_match: 0.45
      performance_history: 0.25
      tfidf_semantic_similarity: 0.20
      domain_specialization: 0.10
    selection_criteria: "highest_weighted_score"
    min_confidence: 0.6
    use_case: "Default strategy for most scenarios"

  performance_priority:
    name: "performance_first"
    description: "Prioritize agents with best historical performance"
    weights:
      competency_match: 0.35
      performance_history: 0.45
      tfidf_semantic_similarity: 0.15
      domain_specialization: 0.05
    selection_criteria: "highest_performance_score"
    min_confidence: 0.7
    use_case: "Critical tasks where quality is paramount"

  semantic_priority:
    name: "semantic_matching"
    description: "Prioritize semantic similarity and task understanding"
    weights:
      tfidf_semantic_similarity: 0.50
      competency_match: 0.30
      performance_history: 0.15
      domain_specialization: 0.05
    selection_criteria: "highest_semantic_alignment"
    min_confidence: 0.5
    use_case: "Complex tasks requiring deep understanding"

  availability_priority:
    name: "availability_first"
    description: "Prioritize agents that are immediately available"
    weights:
      competency_match: 0.30
      availability_score: 0.35
      performance_history: 0.20
      tfidf_semantic_similarity: 0.10
      domain_specialization: 0.05
    selection_criteria: "availability_and_capability"
    min_confidence: 0.5
    use_case: "Time-sensitive tasks requiring immediate attention"

  learning_priority:
    name: "learning_opportunity"
    description: "Prioritize agents that can learn and grow from the task"
    weights:
      competency_match: 0.25
      learning_potential: 0.30
      tfidf_semantic_similarity: 0.25
      performance_history: 0.15
      domain_specialization: 0.05
    selection_criteria: "highest_learning_score"
    min_confidence: 0.4
    use_case: "Tasks with learning potential and development value"

# Advanced Fallback Strategies
fallback_system:
  intelligent_fallback:
    no_suitable_agent:
      action: "Expand search criteria"
      options:
        - lower_confidence_threshold: 0.1
        - enable_cross_domain_fallback: true
        - consider_backup_agents: true
        - use_general_purpose_as_last_resort: true
        - fallback_to_claude_native: true

    all_agents_busy:
      action: "Intelligent queue management"
      options:
        priority_queue: true
        wait_time_limit: 300  # 5 minutes
        use_claude_parallel: true
        notify_user_of_delay: false

    selection_timeout:
      action: "Emergency selection protocol"
      options:
        ignore_load_constraints: true
        minimum_acceptance_score: 0.3
        fallback_to_claude_direct: true
        log_selection_difficulty: false

    system_failure:
      action: "Claude Code native fallback"
      options:
        use_builtin_tools: true
        sequential_execution: true
        minimal_coordination: true
        direct_user_interaction: true

  claude_code_fallback:
    native_capability_fallback:
      implementation: |
        CAPABILITIES:
        - File operations (Read, Write, Edit)
        - Web search and fetch
        - MCP tool usage
        - Bash execution
        - Task delegation
        - Parallel processing

        EXECUTION_STRATEGY:
        1. Analyze task requirements
        2. Select appropriate Claude Code tools
        3. Execute task directly
        4. Provide comprehensive results

# Performance Monitoring and Analytics
performance_monitoring:
  metrics_tracking:
    selection_accuracy: "Track accuracy of agent selections"
    satisfaction_rates: "User satisfaction with selected agents"
    task_completion_times: "Time to complete delegated tasks"
    fallback_usage: "Frequency and reasons for fallback activation"
    tfidf_effectiveness: "Semantic matching performance"
    ml_model_accuracy: "ML categorization performance"

  learning_analytics:
    pattern_recognition: "Identify successful selection patterns"
    model_performance: "Track ML model accuracy over time"
    adaptation_effectiveness: "Measure system learning progress"
    optimization_opportunities: "Identify areas for improvement"

  
# Integration Interface
integration_interface:
  input_sources:
    task_analysis: "Task complexity and domain classification"
    agent_registry: "Available agent capabilities and status"
    historical_performance: "Past performance data and patterns"
    tfidf_system: "Semantic similarity analysis"
    user_preferences: "User-specific selection preferences"
    ml_models: "Machine learning categorization results"

  output_destinations:
    orchestration_engine: "Agent assignment and coordination"
    learning_system: "Performance feedback and model updates"
    monitoring_system: "Selection performance tracking"
    user_interface: "Selection transparency and communication"
    quality_assurance: "Validation and compliance checking"

  system_dependencies:
    task_analysis_system: "Enhanced task classification"
    tfidf_text_processing: "Semantic similarity analysis"
    agent_registry: "Agent capability and availability"
    performance_tracking: "Historical performance data"
    learning_module: "Adaptive model updates"
    quality_validation: "Quality gates and compliance"

  